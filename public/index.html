<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>USC DART Operations Console</title>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="shell">
    <aside class="side-nav">
      <div class="brand">
        <div class="brand-title">USC DART Ops</div>
        <div class="brand-sub">Dispatch + Driver</div>
        <div class="brand-collapsed">DT</div>
        <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">&laquo;</button>
      </div>
      <button class="nav-btn active" data-target="staff-panel" title="Staff &amp; Shifts">
        <span class="nav-icon">&#x1F465;</span><span class="nav-label">Staff &amp; Shifts</span>
      </button>
      <button class="nav-btn" data-target="rides-panel" title="Ride Requests">
        <span class="nav-icon">&#x1F697;</span><span class="nav-label">Ride Requests</span>
      </button>
      <button class="nav-btn" data-target="driver-panel" title="Dispatch &amp; Monitoring">
        <span class="nav-icon">&#x1F4E1;</span><span class="nav-label">Dispatch &amp; Monitoring</span>
      </button>
      <button class="nav-btn" data-target="admin-panel" title="Admin Settings">
        <span class="nav-icon">&#x2699;&#xFE0F;</span><span class="nav-label">Admin Settings</span>
      </button>
      <button class="nav-btn" data-target="profile-panel" title="Profile">
        <span class="nav-icon">&#x1F464;</span><span class="nav-label">Profile</span>
      </button>
      <button class="nav-btn" onclick="showRulesModal()" title="Program Rules">
        <span class="nav-icon">&#x1F4CB;</span><span class="nav-label">Rules</span>
      </button>
      <div class="spacer"></div>
      <button class="nav-btn" onclick="logout()" title="Logout">
        <span class="nav-icon">&#x1F6AA;</span><span class="nav-label">Logout</span>
      </button>
    </aside>

    <main class="content-area">
      <header class="header">
        <div>
          <h1>USC DART Operations Console</h1>
          <p>Dispatch + Driver tools for Disabled Access To Road Transportation</p>
        </div>
      </header>

      <section class="panel tab-panel active" id="staff-panel">
        <h2>Staff &amp; Shifts</h2>
        <div class="sub-tabs">
          <button class="sub-tab active" data-subtarget="staff-schedule-view">Schedule</button>
          <button class="sub-tab" data-subtarget="staff-shifts-view">Edit Shifts</button>
        </div>
        <div class="sub-panel" id="staff-schedule-view">
          <div class="card"><div id="employee-bar" class="employee-bar"></div></div>
          <div class="card">
            <div class="card-header-row">
              <h3>Schedule View</h3>
              <div class="schedule-toggle">
                <button class="btn toggle-btn active" data-schedule-mode="weekly" onclick="setScheduleMode('weekly')">Weekly</button>
                <button class="btn toggle-btn" data-schedule-mode="daily" onclick="setScheduleMode('daily')">Daily</button>
              </div>
            </div>
            <div class="schedule-nav">
              <div class="nav-left">
                <button class="btn" onclick="changeScheduleWeek(-1)">&laquo; Prev Week</button>
                <button class="btn" onclick="changeScheduleDay(-1)">&lt; Prev Day</button>
              </div>
              <input type="date" id="schedule-date" onchange="onScheduleDateChange()">
              <div class="nav-right">
                <button class="btn" onclick="changeScheduleDay(1)">Next Day &gt;</button>
                <button class="btn" onclick="changeScheduleWeek(1)">Next Week &raquo;</button>
              </div>
            </div>
            <div id="day-schedule" class="day-schedule"></div>
            <div class="schedule-legend">
              <span class="legend-item"><span class="legend-color shift"></span> Driver on shift</span>
              <span class="legend-item"><span class="legend-color ride"></span> Scheduled ride</span>
            </div>
          </div>
        </div>
        <div class="sub-panel" id="staff-shifts-view" style="display:none;">
          <div class="card">
            <h3>Add/Edit Shifts</h3>
            <p class="small-text">Click and drag on the grid to add shifts. Click existing shifts to remove.</p>
            <label>Employee
              <div class="flex-row">
                <select id="shift-employee"></select>
                <button class="btn secondary" id="shift-employee-profile" type="button">View Profile</button>
              </div>
            </label>
            <div id="shift-grid" class="shift-grid"></div>
          </div>
        </div>
      </section>

      <section class="panel tab-panel" id="rides-panel">
      <h2>Ride Requests</h2>
      <div class="sub-tabs">
        <button class="sub-tab active" data-subtarget="rides-active-view">Active Rides</button>
        <button class="sub-tab" data-subtarget="rides-calendar-view">Calendar</button>
        <button class="sub-tab" data-subtarget="rides-history-view">History</button>
      </div>
      <div class="sub-panel" id="rides-active-view">
        <div style="margin-bottom:12px;">
          <input type="text" id="ride-filter-input" placeholder="Filter rides by name, location, or status..." style="width:100%;">
        </div>
        <div class="card" id="sample-rides-card" data-dev-only hidden aria-hidden="true">
          <button id="load-sample-rides" class="btn secondary">Load Sample Rides (Dev)</button>
        </div>
        <div class="card" id="unassigned-list">
          <h3>Unassigned Rides (Today)</h3>
          <div class="list" id="unassigned-items"></div>
        </div>
        <div class="card" id="pending-list">
          <h3>Pending Requests</h3>
          <div class="list" id="pending-items"></div>
        </div>
        <div class="card" id="approved-list">
          <h3>Approved / Scheduled</h3>
          <div class="list" id="approved-items"></div>
        </div>
      </div>
      <div class="sub-panel" id="rides-calendar-view" style="display:none;">
        <div class="card">
          <h3>Weekly Ride Schedule</h3>
          <p class="small-text">Color-coded ride grid (08:00–19:00, Mon–Fri).</p>
          <div class="schedule-nav">
            <div class="nav-left">
              <button class="btn" id="ride-week-prev" type="button">&laquo; Prev Week</button>
            </div>
            <div class="small-text" id="ride-week-label"></div>
            <div class="nav-right">
              <button class="btn" id="ride-week-next" type="button">Next Week &raquo;</button>
            </div>
          </div>
          <div id="ride-schedule-grid"></div>
        </div>
      </div>
      <div class="sub-panel" id="rides-history-view" style="display:none;">
        <div class="card" id="history-list">
          <h3>Completed &amp; No-Show History</h3>
          <div class="list" id="history-items"></div>
        </div>
      </div>
      </section>

      <section class="panel tab-panel" id="driver-panel">
        <h2>Dispatch &amp; Monitoring</h2>
        <div class="card">
          <h3>Active Drivers</h3>
          <div id="driver-dashboard" class="driver-dashboard"></div>
        </div>
        <div class="card" id="driver-detail" style="display:none;">
          <div class="card-header-row">
            <h3 id="driver-detail-title">Driver: —</h3>
            <div>
              <button class="btn secondary" id="admin-clock-toggle">Clock In</button>
            </div>
          </div>
          <div class="list" id="driver-ride-list"></div>
        </div>
        <div class="card">
          <div class="toggle-header" onclick="toggleAllActiveRides(this)">
            <h3>All Active Rides <span id="active-rides-count"></span></h3>
            <button class="toggle-btn-slim" type="button">▸</button>
          </div>
          <div id="all-active-rides" style="display:none;">
            <div class="list" id="all-active-rides-list"></div>
          </div>
        </div>
        <div class="card">
        <h3>USC Campus Map</h3>
        <div class="map-wrapper office-map">
          <iframe src="https://maps.usc.edu/" title="USC Campus Map"></iframe>
        </div>
        <div class="map-actions">
          <a class="map-full-link" href="https://maps.usc.edu/" target="_blank" rel="noopener noreferrer">Open full map</a>
        </div>
      </div>
    </section>

      <section class="panel tab-panel" id="admin-panel">
        <h2>Admin Settings</h2>
        <div class="card">
          <h3>Search by USC ID</h3>
          <div class="flex-row">
            <input type="text" id="admin-usc-search" placeholder="Enter 10-digit USC ID" maxlength="10" pattern="[0-9]{10}">
            <button class="btn primary" id="admin-usc-search-btn" type="button">Search</button>
          </div>
          <div id="admin-search-result" class="small-text"></div>
        </div>
        <div class="card">
          <h3>Create User</h3>
          <div class="form-grid">
            <label>Name<input type="text" id="admin-new-name" required></label>
            <label>USC Email<input type="email" id="admin-new-email" required></label>
            <label>Phone<input type="tel" id="admin-new-phone"></label>
            <label>USC ID (10 digits)<input type="text" id="admin-new-uscid" maxlength="10" required></label>
            <label>Role
              <select id="admin-new-role">
                <option value="rider">rider</option>
                <option value="driver">driver</option>
                <option value="office">office</option>
              </select>
            </label>
            <label>Temp Password<input type="password" id="admin-new-password" required></label>
          </div>
          <button class="btn primary" id="admin-create-btn" type="button">Create User</button>
          <div id="admin-create-message" class="small-text"></div>
        </div>
        <div class="card">
          <h3>Users</h3>
          <div class="small-text">Manage riders, drivers, and office accounts. You cannot delete your own office account.</div>
          <div class="table-responsive">
            <table class="grid-table" id="admin-users-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Username</th>
                  <th>Role</th>
                  <th>USC Email</th>
                  <th>USC ID</th>
                  <th>Phone</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="panel tab-panel" id="profile-panel">
        <h2>User Profile</h2>
        <div id="admin-profile-content" class="card"></div>
      </section>

    </main>
  </div>
  <script src="/utils.js"></script>
  <script src="app.js"></script>
</body>
</html>
